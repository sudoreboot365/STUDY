## Interfaces and Cables
- 802.3 = Ethernet
- Ethernet cables
	- AKA "Twisted-pair cables" AKA "UTP/STP" AKA "Copper straight-through" (packet tracer)
	- Electric signals
	- maximum length = 100m
	- 10BASE and 100 Base pins (only uses 4/8 wires)
		- Straight-Through
		- ![[attachments/Pasted image 20251003021314.png|260x100]]
		- Crossover
		- ![[image-14.png|268x100]]
		- Switches are the only devices who transmit on 3/6 and receive on 1/2
		- Auto MDI-X means we dont have to worry about using straight-through or crossover
	- 1000BASE and 10GBASE
		- Every pair is bi-directional
		- ![[image-15.png|210x102]]
- Fiber Optic
	- For distances over 100m
	- Light signals
	- Require a transceiver to plug into port
	- MMF vs SMF
		- MMF cheaper
			- bc LED transceivers vs Laser transceivers
		- SMF longer distances

ETHERNET STANDARDS

| **Speed**            | **Common**  | **802.3_** |
| -------------------- | ----------- | ---------- |
| 10BASE-T (10 Mbps)   | ethernet    | i          |
| 100BASE-T (100 Mbps) | fast eth    | u          |
| 1000BASE-T (1 Gbps)  | gigabit eth | ab         |
| 10GBASE-T (10 Gbps)  | 10 gig eth  | an         |

FIBER OPTIC STANDARDS

| **Speed**   | **802.3_** | **Mode** | **Max distance** |
| ----------- | ---------- | -------- | ---------------- |
| 1000BASE-LX | z          | MMF      | 550m             |
| 1000BASE-LX | z          | SMF      | 5,000m           |
| 10GBASE-SR  | ae         | MMF      | 400m             |
| 10GBASE-LR  | ae         | SMF      | 10,000m          |
| 10GBASE-ER  | ae         | SMF      | 30,000m          |

## OSI Model & TCP/IP
- in packet tracer
	- G on interface = "gigabit ethernet"
	- F on interface = "fast ethernet"
- Misunderstandings
	- devices are not members of networks, their interfaces are
	- devices dont have IP addresses, their interfaces do

## Cisco IOS CLI
- Rollover cable (serial ↔ rj-45) + Console port + PuTTY (connection type: serial)
- `>` = exec mode
- `#` = privileged mode
	- `enable`/`disable` = enter/exit
	- `show running-config` / `sh run`
	- `show startup-config`
	- `write` / `write memory` / `copy running-config startup-config` = save as startup-config
- `?` = see available commands
- `configure terminal` / `conf t`= enter configuration mode
	- `exit` = exit global conf mode
	- passwords
		- `enable password password_here`
		- `service password-encryption` = dont display password, but weak
			- `no service password-encryption` = dont encrypt future passwords, but already encrypted passwords will remain
		- `enable secret password_here` = dont display password, stronger
	- `do` = privileged mode commands while in config mode
	- `no` = disables a command which is turned on
	- `hostname host_name_here` 

## Ethernet LAN Switching
- Ethernet frame header and trailer
	- Preamble (7) and SFD (1) - synchronization / start parsing here
	- Destination and Source MAC (6)
	- EtherType (2) - what is the type of PACKET is the PAYLOAD.
	- FCS (4) - Data integrity check
		- ethernet FCS: more robust, integrity of headers AND payload
		- ipv4 checksum: basic, integrity of the packet headers ONLY
		- tcp/udp checksum: basic, integrity of the segment headers AND payload
	- frame is minimum 64 bytes
- MAC addresses
	- first 6 hexadeciaml are the OUI (aka manufacturer)
	- packet tracer wants this format: AAAA.BBBB.CCCC
	- dynamic MACs are removed from mac address-table after 5 minutes of inactivity
	- mac address-table: maps MAC → egress interface
	- `show mac address-table`
	- `clear mac address-table dynamic`
- ARP
	- arp table: maps local IP addresses → mac addresses
		- PCs: `arp -a`
		- CISCO devices: `show arp`
	- arp request: Destination MAC = FFFF.FFFF.FFFF
		- when router receives FFFF.FF... → flood
		- when host receives FFF.FF.... → check if dest IP matches my own IP
			- yes? send ARP reply
			- no? drop
	- ping always sends 5 ICMP echos. 
		- the first 1/5 may fail if MAC unknown, so needs to do an ARP
- Packet tracer quirk:
	- 'noise' like CDP frames every 60 seconds and BDPU frames are not shown


| Class | 1st octet | def mask (dec) | def mask (cidr) |
| ----- | --------- | -------------- | --------------- |
| A     | <127      | 255.0.0.0      | /8              |
| B     | 128+      | 255.255.0.0    | /16             |
| C     | 192+      | 255.255.255.0  | /24             |
| D     | 224+      |                |                 |
| E     | 240+      |                |                 |

## IPv4 addresses
- 2 hex = 1 byte = 8 bits
- SWITCH: manually setting IP addresses
	- [router#] `show interfaces g0/0` details of 1 interface
	- [router#] `show ip interface brief` shows ip address per interface
		- `do sh ip in br` from config mode
		- status column: admin down / cable unplugged (Down) / both ok (Up)
		- protocol column: down = bad cabling or other side down. up = working
	- [router(config)#] `interface g0/0` = enter configuration for a specific interface
	- [router(config-if)#] `ip address x.x.x.x y.y.y.y` = set the ip address and subnet mask
	- [router(config-if)#] `no shutdown` = switch on a administratively down interface
	- [router(config-if)#] `desc text goes here` = add human readable description
- ROUTER: manually setting IP addresses
	- [switch#] `show ip interface brief` still works here
		- use this for ip, status, and protocol
		- switch interfaces are up by default, whereas router interfaces are admin down by default
	- [switch#] `show interfaces status`
		- use this for vlan, duplex, speed
	- [switch#] `show interfaces` / `show interfaces g0/1` 
		- use this to show errors
	- [switch(conf)#] `interface f0/1` / `interface range f0/1 - 5`
	- [switch(conf-if)#] `speed ?` / `speed 10` / `speed 100` / `speed auto`
	- [switch(conf-if)#] `duplex auto` / `duplex full` / `duplex half`
	- [switch(conf-if)#] `desc textGoesHere`
	- [switch(conf-if)#] `shutdown` / `no shutdown`
- Duplex
	- devices connected to hubs must use half-duplex
	- auto-negoatiate: will set half for 10/100 mbps, but full for 1000 mbps
	- CSMA/CD = avoids collisions on half-duplex

## IPv4 Headers
- Version (4) - 4 or 6
- IHL - header length 
	- Usually just 5 which means "no optional headers"
- DHSCP - QoS flags
- ECN
	- congested receiving router marks incoming L3 packets with ECN=11 "i'm congested!"
	- receving host marks replies with L4 TCP segments with ECE=1 "slow down!"
	- sending host marks subsequent L4 TCP segments with CWD=1 "understood, slowing down!"
- Total Length (headers+payload)
	- min 20
	- max 65,535
- Identification - The original segment which this is fragment belongs to
	- MTU = 1500 bytes
	- can be 1,2,3... or completely randomized for security
- Flags
	- 000 = unfragmented, but allowed
	- 010 = unfragmented, not allowed
	- 001 = fragmented, with more to come
	- 000 = fragmented, last one
- Offset
	- where this fragment belongs in the original datagram
	- divided by 8 bytes to save space
- TTL
	- routers drop if TTL=0
	- TTL is hopcount, decreased by 1 at every router.
	- recommend default TTL is 64
- Protocol
	- TCP (6)
	- UDP (17)
	- Control: ICMP (1), IGMP
	- Routing protocols: OSPF (89), EIGRP
	- VPN/tunneling: GRE, ESP, AH
- Header checksum
- Source IP
- Destination IP

## IPv4 Routing
- WAN = think of a set of routers
- host IPs vs network IPs
	- host IPs = 192.168.1.N, some host bit
	- network IPs = 192.168.1.0, host bit is 0
		- can be an entire LAN
		- can be just the p2p link between 2 routers
- [router#] `show ip route` = show routing table
- When you set IP adress on any interface (`interface g0/1` → `ip address nnn.nnn.n.h\24...` → `no shutdown`) you always get 2 entries added to routing table
	- `C nnn.nnn.n.0\24` = any address of sharing same network address, dont look for next hop IP, go straight to ARP table
	- `L nnn.nnn.n.h\32` = here to route to myself

## Static routes
![[image-16.png|446x90]]

|                              | Destination                                    | Next Hop                                       |
| ---------------------------- | ---------------------------------------------- | ---------------------------------------------- |
| entry on R1's routing table: | to reach blue network<br>192.168.**4.0**/24    | the next hop is blue IP<br>192.168.**13.3**/24 |
| entry on R4's routing table: | to reach the red network<br>192.168.**1.0**/24 | the next hop is red IP<br>192.168.**34.3**/24  |

- [Router(config)#] `ip route [destination-ip] [subnet mask] [next hop ip]`
	- the entry will have `S` for static
- [Router(config)#] `ip route [destination-ip] [subnet mask] [exit interface]`
	- good for p2p connections between routers, but may create unnecessary ARP traffic if that exit interface leads to multiple subnets
- Default gateway is just when destination IP = `0.0.0.0 0.0.0.0`
	- its just the least specific route possible

## Troubleshooting
- on PC: check `ipconfig /all`
- on PC: try `ping default-gateway`
- on router: check interfaces with `show ip int brief`
- on router: check routing table with `show ip route`
	- cancel a static entry: `no ip route...`

## Subnetting

| binary   | decimal | CIDR | block size |
| -------- | ------- | ---- | ---------- |
| 10...    | 128     | + /1 | 128        |
| 110...   | 192     | + /2 | 64         |
| 1110...  | 224     | + /3 | 32         |
| 11110... | 240     | + /4 | 16         |

- how to calculate subnet address
	- from weird octave, find block size.
	- keep adding block size to self until exceeds
- `/30` is best subnet mask for p2p networks betwene 2 routers

- subnet1: 192.168.5.0/25
	- pc1: 192.168.5.1  255.255.255.128
	- r1 interface: 192.168.5.126 255.255.255.128
- subnet2: 192.168.5.128/26
	- pc2: 192.168.5.129 255.255.255.192
	- r2 interface: 192.168.5.190 255.255.255.192
- subnet3: 192.168.5.192/28
	- pc3: 192.168.5.193 .240
	- r3: 192.168.5.206 .240
- subnet4: 192.168.5.208/28
	- pc4: 192.168.5.209 .240
	- r4: 192.168.5.222 .240
- subnet5: 192.168.5.224/30
	-  for 2 P2P interfaces

- purpose of subnetting
	- grouping hosts by shared network bits (instead of say sequentailly) so the route to them can be collectively listed as a single entry in routing table
	- packets to other hosts in same subnet do not need to go up to router. can directly ARP / only go to the switch
## VLANs
- LAN = single broadcast domain (dest MAC = FFFF.FFFF.FFFF)
- cuts down on broadcast traffic
	- ARP, DHCP DOTA, STP BDPUs, CDP/LLDP, IPv6 neighbor discovery (AKA ARP)
		- ARP 2-5 minute timeout
		- DHCP renew least halfway through 12 hour lease default
		- BDPU is every 2 seconds  per switch port (and also per VLAN for trunk ports)
		- CDP every 60s, LLDP every 30s
- VLANs are configured on SWITCH interfaces. the host has no idea what VLAN its on
- `show vlan brief`
- `vlan 10` → `name name_here`
- `interface range g1/0 - 3` → `switchport mode access` → `switchport access vlan 10`
- there are always 5 default vlans (4 are deprecated)
- trunk ports = tagged ports
- access ports = untagged ports
- trunking protocol (802.1Q AKA dot1q)
	- 16bit tag between 'source MAC' and 'EtherType' field
	- TPID {tag protocol indentifier} = 16 bits fixed. 0x8100. "this is a 802.1Q frame"
	- TCI {tag control information}
		- PCP {priority code point} = 3bits. CoS {class of service} AKA congested networks
		- DEI {drop eligiible indicator}= 1bit, can be dropped if congestion
		- VID {vlan id} = 12 bits. 
			- 2^12 = 4096, only 4094 useable
			- 1-1005 : normal VLANs
			- 1006-4094 : extended VLANs
- Native VLANS
	- trunk ports add VLAN tags for all VLANs EXCEPT for the native vlan (1, by default)
- Setup
	- `switchport trunk encapsulation dot1q`
	- `switchport mode trunk`
- Check
	- `do show interfaces trunk`  ← trunk ports
	- `do show vlan brief` ← access ports
- Configure
	- `switchport trunk allowed vlan (num/add num/remove #)
		- `#` can look like `1-5,10`
	- `swithcport trunk native vlan #`
- Router on a stick
	- trunk port connecting to a single physical router interface
	- that router interface must be split into sub-interfaces
	- `interface g0/0.10`
	- `encapsulation dot1q 10` or `encapsulation dot1q 10 native`
	- `ip address [last-usable-address-of-subnet] [mask]`
	- `do show ip interface brief`

2 mistakes i made on lab:
- even after doing `no shutdown` on subinterfaces, still need to do it on the parent
- even after doing `switchport trunk allowed vlan #` on a trunk port, still need to create all vlans on it with `vlan #`

- On Router
	- delete subinterface: `no interface g0/0.10`
	- restore original interface: `default interface g0/0`
- On Switch
	- `default interface g0/0`
	- `ip routing` (enables layer 3 routing) 
	- `interface g0/1` → `no switchport` (changes from layer 2 to layer 3 port) → `ip address ....`
	- set up SVIS
		- `interface vlan 10`
		- `ip address ....`

## Lab 18
- changing 'Switch ↔ ROAS' to 'layer 3 switch ↔ router (p2p)'
	- routers interface
		- delete subinterfaces `no interface g0/0.10`
		- assign IP to parent interface
	- swithc interface
		- set to default `default interface g1/0/2`
		- make into layer 3: `no switchport` →  assign ip
		- set default gateway to router: `ip routing` → `ip route 0.0.0.0 0.0.0.0 next-hop`
			- check: `do show ip route`
	- set up SVIs inside switch
		- check: `do show vlan brief`
		- create SVI: `interface vlan 10` + assign ip + `no shutdown`

## DTP/VTP
- DTP = dynamic trunking protocol
	- auto negotiate if trunk/acess port
	- `switchport mode dynamic desriable`: access ⇔ other side `switchport mode access`
		- "actively tries to trunk unless explicitly refused"
	- `switchport mode dynamic auto:` trunk if (1) `switchport mode trunk` or (2) `switchport mode dynamic desirable`
		- "only trunk if other side tries to trunk"
	- 2 notes:
		- ports to ROAS must still be set manually with `switch mode trunk`
		- disabling it: `switchport nonegotiate`
		- DTP also negotiates whether dot1q or isl
- VTP = VLAN trunking protocol.
	- configure vlans on only 1 central switch
	- if servers add/modify/delete VLANS, then update revision number + store in NVRAM + advertise over trunks to clients, who advertise to other clients
		- advertisements limited to VTP domains
		- if a client with no domain name (null) receives advertisement, will automatically join that domain
	- problem: connect old switch with high revision number
	- transparent mode: forwards advertisements if same domain, but not does forward its own or sync
	- versions
		- v2 can use token ring VLANs (obsolete)
		- v3 
	- 2 ways to reset revision number to 0
		- change to unused domain name
		- change to `vtp mode transparent`

## STP
- bridge ID 
	- 3 parts
		- bridge priority
			- lowest value is 32768
			- multiples of 4096
		- vlan ID
			- highest is 4095
			- PVST runs a separate STP per vlan.
		- mac address
- STP
	- elect root bridge
		- all ports on root bridge are designated
	- find single root port on each switch by lowest cost (cost is 100/19/4/2)
		- tiebreaker? choose port iwth lowest *neighbor* bridge ID
		- 2 connections between same 2 switches? choose port iwth lowest *neighbor* port ID
			- `0x8001` = default port priority 128 = 80, port number 1
		- port on other end of cable from root is designated
	- now all thats left are non-tree edges
		- 1 designated, 1 blocking.
		- designated = side with lower cost to root. nondesignated = side with higher cost to root
			- tiebreaker is port on switch with lower bridge ID
- True STP
	- BDPUs advertise out of all ports: "I can reach `root_id` (both name and rank) with `root_cost` via port `root_port`
	- if a switch receives a BDPU s.t. `root_id_New` < `root_id` on `port_New`, who has a cost to root of `root_cost_New` connected via cable with `cost_New`, update and begin advertising this new BDPU
		- `root_id` ← `root_id_B`
		- `root_cost` ← `root_cost_New` + `cost_New`
		- `root_port` ← `port_New`
- States
	- Blocking
		- dont send traffic, don't forward BDPUs, don't learn MAC addresses
	- Listening
		- 15s - same except starts sending BDPUs
	- Learning
		- 15s - same except learns MAC addresses from regular traffic
- BPDUs
	- a bridge which believes itself ot be hte root sends these out every 2 seconds
	- a bridge which doesnt believe itself to be hte root is dormant until it receives a BDPU (which ultimatley originated from a root bridge's hello BPDU)
	- only forwarded on designated ports!
	- if doesnt receive a BPDU for 10x2sec, re-assumes self ot be root bridge
	- BDPUs always have MAC address of 
		- STP: 01:80:C2:00:00:00
		- PVST+: 01:00:0C:CC:CC:CD
		- special multicast group for switches (end hosts dont get it, and also dont forward out like broadcasts)
- Other options
	- portfast - ports to end hosts still need to go through listening and learning... 50s wasted. 
		- interface → `spanning-tree portfast`
			- or for ROAS: `spanning-tree portfast trunk` 
	- bpdu guard - disabled if receive any bdpu
		- interface → `spanning-tree bpduguard enable`
		- violation causes `err-disabled` state: 
			- `shutdown` → `no shutdown`
			- `errdisable recovery cause bdpuguard`
	- set both as defualts on all access ports
		- `spanning-tree portfast default`
		- `spanning-tree portfast bpduguard default`
	- bpdu filter - dont send unncessary bpdu traffic to end hosts
- Configurations
	- `spanning-tree mode pvst/rapid-pvst`
	- set root bridge: switch → `spanning-tree vlan 1 root primary/secondary`

## Root Guard
- purpsoe: makes sure another bridge with lower bridge ID doesnt take over
- if root guard enabled port receives a BPDU, it enters "broken - root inconsistent" state until the admin of the erronenous root switch to change its bridge ID
- interface → `spanning-tree guard root`

## Loop Guard
- purpose: disables a port if it stops receving BPDUs (so it doenst go into forwarding)
- bad situation: unidirectional links
	- happens with fiberoptic between 2 switches because they have separate tx and rx
	- there will be a loop in the direction in which tx still occurs
	- if max age timer reaches 0, "broken - loop inconsistent" instead of changing to designated
- Comparison
	- Loop guard prevents things accidentally becoming designated
	- Root guard prevents things accidentally becoming root ports
	- if both configured?
		- the one configred on port overrides one configured globally
		- or the one configured most latest overrides

## RSTP
- blocking becomes discarding
- listening state deleted

## STP Review
- 